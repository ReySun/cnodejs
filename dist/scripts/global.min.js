function htmlDecode(t){var e=document.createElement("div");return e.innerHTML=t,0===e.childNodes.length?"":e.childNodes[0].nodeValue}Date.prototype.format=function(t){t=t||"yyyy-MM-dd";var e=this,r={"M+":e.getMonth()+1,"d+":e.getDate(),"h+":e.getHours(),"m+":e.getMinutes(),"s+":e.getSeconds(),"q+":Math.floor((e.getMonth()+3)/3),S:e.getMilliseconds()};/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(e.getFullYear()+"").substr(4-RegExp.$1.length)));for(var s in r)new RegExp("("+s+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?r[s]:("00"+r[s]).substr((""+r[s]).length)));return t},EJS.Helpers.prototype.include=function(t,e,r){if(t&&e){var s=xtag.createFragment(new EJS({url:t}).text).querySelector(e);if(s)return r?xtag.tools.template.render({text:s.innerHTML},{data:r}):s.innerHTML}},EJS.Helpers.prototype.FormatMoney=function(t,e){if(t=parseFloat(t),e=e||2,isNaN(t))return"";if(0===t)return"0.00";t=t.toFixed(e).split(".");var r=/(\d{1,3})(?=(\d{3})+(?:$|\D))/g;return t[0].replace(r,"$1,")+"."+t[1]},EJS.Helpers.prototype.Newlines=function(t){return t.replace(/\n|\r/g,"<br />")},EJS.Helpers.prototype.getMonthDays=function(t,e){return 32-new Date(t,e,32).getDate()};var storage={events:{},getJSON:function(t,e){var e=e||sessionStorage,r=e.getItem(t);return r?JSON.parse(r):null},setJSON:function(t,e,r){var r=r||sessionStorage;r.setItem(t,JSON.stringify(e)),this.trigger(t,e)},removeJSON:function(t,e){var e=e||sessionStorage,r=e.getItem(t);e.removeItem(t),r&&this.trigger(t)},on:function(t,e){if(this.events[t]?this.events[t].push(e):this.events[t]=[e],arguments.callee&&arguments.callee.caller&&arguments.callee.caller.arguments&&arguments.callee.caller.arguments[0]){var r=arguments.callee.caller.arguments[0];r.nodeName&&/x-html/i.test(r.nodeName)&&(r.xtag.eventkey||(r.xtag.eventkey=1e7*Math.random(),xtag.addEvent(r,"xdestroy",function(t){this.destroy(t.target.xtag.eventkey)}.bind(this))),e.eventkey=r.xtag.eventkey)}},off:function(t,e){this.events[t]&&this.events[t].forEach&&this.events[t].forEach(function(r,s){r==e&&storage.events[t].splice(s,1)})},trigger:function(t,e){this.events[t]&&this.events[t].forEach&&this.events[t].forEach(function(t){t&&t(e)})},destroy:function(t){for(var e in this.events)if(this.events[e]&&this.events[e].length>0){for(var r=[],s=0;s<this.events[e].length;s++)this.events[e][s].eventkey!=t&&r.push(this.events[e][s]);this.events[e]=r}}};xtag.tools._fetch=function(t){var e=xtag;if(t.url&&(t.url.indexOf(".html")==-1?t.dataType="json":t.dataType="text"),t.context){if(/x-form/i.test(t.context.nodeName)){if(e.trigger(t.context,"xsubmit"),t.context.target){var r=e.merge({},tools.parseQuery(location.search.replace(/\?|#/g,"")+location.hash.replace(/\?|#/g,"")),t.data);if("hash"==t.context.target)return void(location.hash=tools.param(r));if(/^#/.test(t.context.target)){var s=document.getElementById(t.context.target.replace("#",""));return void e.trigger(s,"xquerychange",r)}}var o=t.context.getAttribute("session");if(o&&t.data&&storage.setJSON(o,t.data),t.url.indexOf(".html")>-1)return t.complete&&t.complete.call(t.context),t.context&&e.trigger(t.context,"xcomplete"),t.success&&t.success.call(t.context),t.context&&e.trigger(t.context,"xsuccess"),void location.open(t.url,!0)}/x-ajat/i.test(t.context.nodeName)&&e.trigger(t.context,"xfetch")}t.url?(t._error=t.error,t.error=function(t){if("abort"!=t.status){var r="请求失败，请稍后再试!";"parseerror"===t.status&&(r="数据响应格式异常!"),"timeout"===t.status&&(r="请求超时，请稍后再试!"),"offline"===t.status&&(r="网络异常，请稍后再试!"),this._error&&this._error.call(this.context),this.context&&e.trigger(this.context,"xerror",r)}}.bind(t),t._success=t.success,t.success=function(t,r,s){if(s.status<400)"text"!=this.dataType?t&&t.success===!0?(this._success&&this._success.call(this.context,t.data),this.context&&e.trigger(this.context,"xsuccess",t.data),this.context&&/x-ajat/i.test(this.context.nodeName)&&e.trigger(this.context,"xrender",t.data)):t&&302==t.code?(this.context&&(this.context.innerHTML='<div class="tc" style="line-height:1rem">'+t.message+"</div>"),location.href="/index"):(this._error&&this._error.call(this.context,t),this.context&&e.trigger(this.context,"xerror",t)):this._success&&this._success.call(this.context,t);else{if("abort"==s.status)return;var o="请求失败，请稍后再试!";"parseerror"===s.status&&(o="数据响应格式异常!"),"timeout"===s.status&&(o="请求超时，请稍后再试!"),"offline"===s.status&&(o="网络异常，请稍后再试!"),this.xerror&&this.xerror.call(this.context),this.context&&e.trigger(this.context,"xerror",o)}this.complete&&this.complete.call(this.context),this.context&&e.trigger(this.context,"xcomplete")}.bind(t),$.ajax(t)):(t.complete&&t.complete.call(t.context),t.context&&e.trigger(t.context,"xcomplete"),t.success&&t.success.call(t.context),t.context&&e.trigger(t.context,"xsuccess"),t.context&&/x-ajat/i.test(t.context.nodeName)&&e.trigger(t.context,"xrender"))},$(function(){config.isApp||$(document.body).addClass("web-app-control");var t=function(){for(var t=this.querySelectorAll('[class*="right--"]'),e=0;e<t.length;e++){var r=t[e],s=r.className.match(/right--(\d+)/);s&&s[1]&&config&&config.right.userRight.indexOf(parseInt(s[1]))>-1&&xtag.requestFrame(function(){r.className=r.className.replace(s[0],"")}.bind(r))}};$(document.body).on("xsuccess","x-form",function(t){t.target==this&&"none"!==this.getAttribute("toast")&&this.querySelector("form")&&this.querySelector("form").action&&window.toast({align:"bottom",destroy:"destroy",content:this.getAttribute("toast")||"提交成功"})}).on("xerror","x-form",function(t){t.target==this&&"none"!==this.getAttribute("toast")&&window.toast({align:"bottom",destroy:"destroy",content:t.detail&&t.detail.message?t.detail.message:"提交失败"})}).on("xfetch","x-ajat",function(t){t.target!=this||this.getAttribute("insert")||$(this).addClass("loading")}).on("xcomplete","x-ajat",function(t){t.target==this&&$(this).removeClass("loading");var e=$(t.target).closest("x-scrollbox");1==e.length&&e.children(".loading")&&e[0].stopLoading()}).on("xerror","x-ajat",function(t){t.target==this&&xtag.requestFrame(function(){$(this).removeClass("loading").html('<div class="reload"><a class="js-reload"><i class="iconfont">&#xe94a</i><p>戳我刷新</p></a></div>')}.bind(this))}).on("click","x-ajat .js-reload",function(t){var e=$(t.target).closest("x-ajat")[0];e.fetch(e.xtag.action)}).on("xneterror","x-ajat",function(){window.toast({content:"网络异常，请检查网络设置"})}).on("xneterror",function(t){t.target==document.body&&window.toast({content:"网络异常，请检查网络设置"})}).on("xrender","x-ajat",function(){if(location.hash&&location.hash.indexOf("#ui::")==-1){var t=this.querySelector(location.hash);if(t){var e=xtag.closest(this,"x-html");if(e){var r=e.querySelector("x-scrollbox")||e.querySelector(".scrollbox");r&&xtag.skipFrame(function(){r.scrollTop=t.offsetTop})}}}}).on("xrender","x-ajat",function(t){var e=t.detail;e&&e instanceof Array&&0==e.length&&0==this.children.length&&(this.innerHTML=' <div class="tc" style="line-height:1rem;height:1rem">暂无数据</div>')}).on("xhtmlready","x-html",function(){t.call(this)}).on("xrender","x-ajat",function(e){e.target==this&&t.call(this)})}),"serviceWorker"in navigator&&navigator.serviceWorker.register("/sw.js",{scope:"/"}).then(function(t){console.log("Registration succeeded. Scope is "+t.scope)})["catch"](function(t){console.log("Registration failed with "+t)});